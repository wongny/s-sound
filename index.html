<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=none">
    <title>å»£æ±è©±SéŸ³ç·´ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f0f9ff; touch-action: manipulation; }
        .mic-active { animation: pulse 1s infinite; background-color: #ef4444 !important; }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const LEVELS = [
            { t: "é¼ ", jp: "syu2", img: "ğŸ­", alt: ["é¼ ", "è€é¼ ", "æ›¸", "æ•¸", "è–¯", "äº”"] },
            { t: "æ²™", jp: "saa1", img: "ğŸ–ï¸", alt: ["æ²™", "æ²™ç˜", "å±±", "ä¸‰", "è¡«", "ç´—", "ä¸‹"] },
            { t: "æ°´", jp: "seoi2", img: "ğŸ’§", alt: ["æ°´", "ç¡", "æ°´æœ", "ç‘", "é›–"] },
            { t: "çŸ³", jp: "sek6", img: "ğŸª¨", alt: ["çŸ³", "çŸ³é ­", "å°„", "å¸­", "å°º", "ç¢©"] },
            { t: "æ‰‹", jp: "sau2", img: "âœ‹", alt: ["æ‰‹", "æ‰‹éŒ¶", "é¦–", "æŠ–", "å£"] }
        ];

        function App() {
            const [mode, setMode] = useState('home'); // home, play, end
            const [cur, setCur] = useState(0);
            const [isListening, setIsListening] = useState(false);
            const [heard, setHeard] = useState("");
            const [isOk, setIsOk] = useState(false);
            
            const recognitionRef = useRef(null);
            const userWantsActive = useRef(false);

            const speak = (txt) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(txt);
                u.lang = 'zh-HK';
                u.rate = 0.9;
                window.speechSynthesis.speak(u);
            };

            const startRecog = () => {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SR) return;
                const rec = new SR();
                rec.lang = 'zh-HK';
                rec.interimResults = true;
                rec.onstart = () => setIsListening(true);
                rec.onresult = (e) => {
                    let text = e.results[0][0].transcript;
                    setHeard(text);
                    const target = LEVELS[cur];
                    if (text.includes(target.t) || target.alt.some(a => text.includes(a))) {
                        userWantsActive.current = false;
                        rec.stop();
                        handleSuccess();
                    }
                };
                rec.onend = () => {
                    if (userWantsActive.current && mode === 'play') {
                        try { rec.start(); } catch(err) {}
                    } else { setIsListening(false); }
                };
                recognitionRef.current = rec;
                try { rec.start(); } catch(err) {}
            };

            const handleSuccess = () => {
                setIsOk(true);
                speak("å¥½å»å‘€");
                setTimeout(() => {
                    if (cur < LEVELS.length - 1) {
                        setCur(prev => prev + 1);
                        setHeard("");
                        setIsOk(false);
                    } else {
                        setMode('end');
                    }
                }, 1500);
            };

            const toggleMic = () => {
                if (userWantsActive.current) {
                    userWantsActive.current = false;
                    recognitionRef.current?.stop();
                } else {
                    setHeard("");
                    setIsOk(false);
                    userWantsActive.current = true;
                    startRecog();
                }
            };

            // é¦–é 
            if (mode === 'home') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center fade-in">
                        <div className="text-9xl mb-6">ğŸ—£ï¸</div>
                        <h1 className="text-5xl font-black text-blue-600 mb-4">å»£æ±è©± S éŸ³ç·´ç¿’</h1>
                        <p className="text-slate-500 text-xl mb-12 leading-relaxed">å°æœ‹å‹ï¼Œä¸€é½ŠåšŸç·´ç¿’<br/>ã€Œé¼ ã€æ²™ã€æ°´ã€çŸ³ã€æ‰‹ã€å•¦ï¼</p>
                        <button 
                            onClick={() => { setMode('play'); speak("æº–å‚™å¥½æœªï¼Ÿç·´ç¿’é–‹å§‹ï¼"); }}
                            className="bg-blue-600 text-white text-3xl font-black px-16 py-6 rounded-[40px] shadow-2xl active:scale-95 transition-all"
                        >
                            æ’³æˆ‘é–‹å§‹ ğŸš€
                        </button>
                    </div>
                );
            }

            // çµç®—é 
            if (mode === 'end') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center fade-in">
                        <div className="text-9xl mb-6 animate-bounce">ğŸ†</div>
                        <h1 className="text-5xl font-black text-green-500 mb-4">å…¨é—œé”æˆï¼</h1>
                        <p className="text-slate-500 text-xl mb-12">ä½ ä»Šæ—¥å˜…è¡¨ç¾å¥½å‡ºè‰²å‘€ï¼</p>
                        <button 
                            onClick={() => window.location.reload()}
                            className="bg-orange-500 text-white text-2xl font-black px-12 py-5 rounded-[30px] shadow-xl active:scale-95 transition-all"
                        >
                            å†ç©ä¸€æ¬¡ ğŸ”„
                        </button>
                    </div>
                );
            }

            // éŠæˆ²é 
            const item = LEVELS[cur];
            return (
                <div className={`min-h-screen flex flex-col items-center p-6 transition-colors ${isOk ? 'bg-green-50' : 'bg-sky-50'}`}>
                    {/* é€²åº¦æ¢ */}
                    <div className="w-full max-w-md mb-8">
                        <div className="flex justify-between font-black text-blue-500 mb-2 px-2">
                            <span>ç¬¬ {cur + 1} / 5 é—œ</span>
                            <span>{Math.round(((cur)/5)*100)}%</span>
                        </div>
                        <div className="w-full h-4 bg-white rounded-full overflow-hidden shadow-inner border border-blue-100">
                            <div 
                                className="h-full bg-blue-500 transition-all duration-500" 
                                style={{width: `${((cur + 1) / 5) * 100}%`}}
                            ></div>
                        </div>
                    </div>

                    <div className={`bg-white rounded-[45px] shadow-xl p-8 w-full max-w-md flex flex-col items-center relative transition-all ${isOk ? 'scale-105 border-4 border-green-400' : ''}`}>
                        <div className="text-[10rem] mb-2 leading-none">{item.img}</div>
                        <div className="text-8xl font-black text-slate-800 mb-2">{item.t}</div>
                        <div className="text-slate-400 text-2xl font-mono mb-8 tracking-widest uppercase">{item.jp}</div>

                        <button 
                            onClick={toggleMic}
                            disabled={isOk}
                            className={`w-full py-8 rounded-[35px] text-3xl font-black transition-all text-white shadow-lg ${isListening ? 'mic-active' : 'bg-blue-600 active:scale-95'}`}
                        >
                            {isListening ? "è½ç·Šä½ è¬›..." : "æŒ‰æ­¤ç·´ç¿’è®€éŸ³"}
                        </button>

                        <div className="mt-8 text-center min-h-[100px] w-full bg-slate-50 rounded-3xl p-4 border-2 border-dashed border-slate-200 flex flex-col justify-center">
                            {isOk ? (
                                <p className="text-4xl font-black text-green-500">å¥½å»å‘€ï¼âœ…</p>
                            ) : (
                                <>
                                    <p className="text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-widest">ç³»çµ±è½åˆ°ï¼š</p>
                                    <p className="text-3xl font-black text-red-500 leading-tight">
                                        {heard || (isListening ? "è«‹ç™¼è²..." : "---")}
                                    </p>
                                </>
                            )}
                        </div>
                    </div>

                    <div className="mt-8 flex gap-4">
                        <button 
                            onClick={() => speak(item.t)}
                            className="bg-white border-2 border-blue-100 text-blue-500 px-8 py-4 rounded-2xl font-bold flex items-center gap-2 shadow-sm active:bg-blue-50"
                        >
                            ğŸ”ˆ è½ç¤ºç¯„
                        </button>
                        <button 
                            onClick={() => setMode('home')}
                            className="bg-slate-200 text-slate-600 px-8 py-4 rounded-2xl font-bold shadow-sm active:bg-slate-300"
                        >
                            ğŸ  é¦–é 
                        </button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

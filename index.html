<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=none">
    <title>å»£æ±è©±SéŸ³ç·´ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f0f9ff; margin: 0; }
        .mic-active { animation: pulse 1s infinite; background-color: #ef4444 !important; }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        const LEVELS = [
            { t: "é¼ ", jp: "syu2", img: "ğŸ­", alt: ["é¼ ", "è€é¼ ", "æ›¸", "æ•¸", "è–¯"] },
            { t: "æ²™", jp: "saa1", img: "ğŸ–ï¸", alt: ["æ²™", "æ²™ç˜", "å±±", "ä¸‰", "è¡«"] },
            { t: "æ°´", jp: "seoi2", img: "ğŸ’§", alt: ["æ°´", "ç¡", "æ°´æœ"] },
            { t: "çŸ³", jp: "sek6", img: "ğŸª¨", alt: ["çŸ³", "çŸ³é ­", "å°„", "å°º"] },
            { t: "æ‰‹", jp: "sau2", img: "âœ‹", alt: ["æ‰‹", "æ‰‹éŒ¶", "é¦–"] }
        ];

        function App() {
            // æ˜ç¢ºåˆå§‹åŒ–ç‚º 'home'
            const [view, setView] = useState('home'); 
            const [cur, setCur] = useState(0);
            const [isListening, setIsListening] = useState(false);
            const [heard, setHeard] = useState("");
            const [isOk, setIsOk] = useState(false);
            
            const recognitionRef = useRef(null);
            const userActive = useRef(false);

            const speak = (txt) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(txt);
                u.lang = 'zh-HK';
                window.speechSynthesis.speak(u);
            };

            const startRecog = () => {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SR) return;
                const rec = new SR();
                rec.lang = 'zh-HK';
                rec.interimResults = true;
                rec.onstart = () => setIsListening(true);
                rec.onresult = (e) => {
                    let text = e.results[0][0].transcript;
                    setHeard(text);
                    const target = LEVELS[cur];
                    if (text.includes(target.t) || target.alt.some(a => text.includes(a))) {
                        userActive.current = false;
                        rec.stop();
                        handleSuccess();
                    }
                };
                rec.onend = () => {
                    if (userActive.current) {
                        try { rec.start(); } catch(err) {}
                    } else { setIsListening(false); }
                };
                recognitionRef.current = rec;
                try { rec.start(); } catch(err) {}
            };

            const handleSuccess = () => {
                setIsOk(true);
                speak("å¥½å»å‘€");
                setTimeout(() => {
                    if (cur < LEVELS.length - 1) {
                        setCur(c => c + 1);
                        setHeard("");
                        setIsOk(false);
                    } else {
                        setView('end');
                    }
                }, 1500);
            };

            const toggleMic = () => {
                if (userActive.current) {
                    userActive.current = false;
                    recognitionRef.current?.stop();
                } else {
                    setHeard("");
                    setIsOk(false);
                    userActive.current = true;
                    startRecog();
                }
            };

            // --- ç•«é¢æ¸²æŸ“é‚è¼¯ ---

            if (view === 'home') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-white">
                        <div className="text-9xl mb-8">ğŸ—£ï¸</div>
                        <h1 className="text-5xl font-black text-blue-600 mb-6 text-center">å»£æ±è©± S éŸ³ç·´ç¿’</h1>
                        <p className="text-slate-500 text-xl mb-12 text-center">å°æœ‹å‹ï¼Œæº–å‚™å¥½ä¸€é½ŠæŒ‘æˆ°æœªï¼Ÿ</p>
                        <button 
                            onClick={() => { setView('play'); speak("æº–å‚™å¥½æœªï¼Ÿé–‹å§‹ï¼"); }}
                            className="bg-blue-600 text-white text-3xl font-black px-20 py-8 rounded-[40px] shadow-2xl active:scale-95 transition-all"
                        >
                            é–‹å§‹ç·´ç¿’ ğŸš€
                        </button>
                    </div>
                );
            }

            if (view === 'end') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-green-50">
                        <div className="text-9xl mb-8">ğŸ†</div>
                        <h1 className="text-5xl font-black text-green-600 mb-4">æŒ‘æˆ°æˆåŠŸï¼</h1>
                        <p className="text-slate-600 text-xl mb-12 text-center">ä½ ä»Šæ—¥è¬›å¾—å¥½æ¸…æ¥šå‘€ï¼</p>
                        <button 
                            onClick={() => window.location.reload()}
                            className="bg-orange-500 text-white text-2xl font-black px-12 py-6 rounded-[30px] shadow-xl"
                        >
                            å†ç©ä¸€æ¬¡ ğŸ”„
                        </button>
                    </div>
                );
            }

            // éŠæˆ²ä¸­ä»‹é¢
            const item = LEVELS[cur];
            return (
                <div className={`min-h-screen flex flex-col items-center p-6 transition-colors ${isOk ? 'bg-green-50' : 'bg-sky-50'}`}>
                    <div className="w-full max-w-md mb-8 mt-4">
                        <div className="w-full h-4 bg-white rounded-full border border-blue-100 overflow-hidden shadow-inner">
                            <div className="h-full bg-blue-500 transition-all duration-500" style={{width: `${((cur + 1)/5)*100}%`}}></div>
                        </div>
                        <p className="text-center mt-2 font-bold text-blue-500">é€²åº¦ï¼š{cur + 1} / 5</p>
                    </div>

                    <div className="bg-white rounded-[50px] shadow-xl p-10 w-full max-w-md flex flex-col items-center relative">
                        <div className="text-[10rem] mb-2 leading-none">{item.img}</div>
                        <div className="text-8xl font-black text-slate-800 mb-2">{item.t}</div>
                        <div className="text-slate-400 text-2xl font-mono mb-10">{item.jp}</div>

                        <button 
                            onClick={toggleMic}
                            className={`w-full py-9 rounded-[35px] text-3xl font-black text-white shadow-lg ${isListening ? 'mic-active' : 'bg-blue-600'}`}
                        >
                            {isListening ? "è½ç·Šä½ è¬›..." : "æŒ‰æ­¤ç·´ç¿’è®€éŸ³"}
                        </button>

                        <div className="mt-8 text-center min-h-[100px] w-full bg-slate-50 rounded-3xl p-6 flex flex-col justify-center border-2 border-dashed border-slate-200">
                            <p className="text-4xl font-black text-red-500 leading-tight">
                                {isOk ? "å¥½å»å‘€ï¼âœ…" : (heard || (isListening ? "è«‹ç™¼è²" : "---"))}
                            </p>
                        </div>
                    </div>
                    
                    <div className="mt-8 flex gap-4">
                        <button onClick={() => speak(item.t)} className="bg-white border-2 border-blue-200 text-blue-500 px-8 py-4 rounded-2xl font-bold">ğŸ”ˆ è½ç¤ºç¯„</button>
                        <button onClick={() => setView('home')} className="bg-slate-200 text-slate-600 px-8 py-4 rounded-2xl font-bold">ğŸ  è¿”å›é¦–é </button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
